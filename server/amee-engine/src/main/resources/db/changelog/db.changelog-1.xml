<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<databaseChangeLog xmlns="http://www.liquibase.org/xml/ns/dbchangelog/1.9"
                   xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
                   xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog/1.9 http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-1.9.xsd">

    <!-- New tables -->
    <changeSet author="david" id="1-1">
        <comment>Add DATA_ITEM table.</comment>
        <createTable tableName="DATA_ITEM">
            <column autoIncrement="true" name="ID" type="BIGINT UNSIGNED">
                <constraints nullable="false" primaryKey="true"/>
            </column>
            <column defaultValue="" name="UID" type="CHAR(12)">
                <constraints nullable="false" unique="true"/>
            </column>
            <column defaultValue="" name="NAME" type="VARCHAR(255)">
                <constraints nullable="false"/>
            </column>
            <column defaultValue="" name="PATH" type="VARCHAR(255)">
                <constraints nullable="false"/>
            </column>
            <!-- Make liquibase create TIMESTAMP instead of DATETIME. -->
            <column name="CREATED" type="TIMESTAMP default '0000-00-00 00:00:00'">
                <constraints nullable="false"/>
            </column>
            <column name="MODIFIED" type="TIMESTAMP default '0000-00-00 00:00:00'">
                <constraints nullable="false"/>
            </column>
            <column name="ITEM_DEFINITION_ID" type="INT UNSIGNED">
                <constraints nullable="false"/>
            </column>
            <column name="DATA_CATEGORY_ID" type="INT UNSIGNED">
                <constraints nullable="false"/>
            </column>
            <column defaultValueNumeric="0" name="STATUS" type="TINYINT UNSIGNED">
                <constraints nullable="false"/>
            </column>
        </createTable>
        <modifySql dbms="mysql">
             <append value=" ENGINE=InnoDB DEFAULT CHARSET=utf8"/>
        </modifySql>
        <modifySql>
            <replace replace="`UID` CHAR(12) DEFAULT '' NOT NULL"
                     with="UID CHAR(12) CHARACTER SET ascii COLLATE ascii_bin NOT NULL DEFAULT ''"/>
        </modifySql>
    </changeSet>

    <changeSet author="david" id="1-2">
        <comment>Add PROFILE_ITEM table.</comment>
        <createTable tableName="PROFILE_ITEM">
            <column autoIncrement="true" name="ID" type="BIGINT UNSIGNED">
                <constraints nullable="false" primaryKey="true"/>
            </column>
            <column defaultValue="" name="UID" type="CHAR(12)">
                <constraints nullable="false" unique="true"/>
            </column>
            <column defaultValue="" name="NAME" type="VARCHAR(255)">
                <constraints nullable="false"/>
            </column>
            <!-- Make liquibase create TIMESTAMP instead of DATETIME. -->
            <column name="CREATED" type="TIMESTAMP default '0000-00-00 00:00:00'">
                <constraints nullable="false"/>
            </column>
            <column name="MODIFIED" type="TIMESTAMP default '0000-00-00 00:00:00'">
                <constraints nullable="false"/>
            </column>
            <column name="START_DATE" type="DATETIME">
                <constraints nullable="false"/>
            </column>
            <column name="END_DATE" type="DATETIME"/>
            <column name="ITEM_DEFINITION_ID" type="INT UNSIGNED">
                <constraints nullable="false"/>
            </column>
            <column name="DATA_ITEM_ID" type="BIGINT UNSIGNED">
                <constraints nullable="false"/>
            </column>
            <column name="PROFILE_ID" type="BIGINT UNSIGNED">
                <constraints nullable="false"/>
            </column>
            <column defaultValueNumeric="0" name="STATUS" type="TINYINT UNSIGNED">
                <constraints nullable="false"/>
            </column>
        </createTable>
        <modifySql dbms="mysql">
             <append value=" ENGINE=InnoDB DEFAULT CHARSET=utf8"/>
        </modifySql>
        <modifySql>
            <replace replace="`UID` CHAR(12) DEFAULT '' NOT NULL"
                     with="UID CHAR(12) CHARACTER SET ascii COLLATE ascii_bin NOT NULL DEFAULT ''"/>
        </modifySql>
    </changeSet>

    <changeSet author="david" id="1-3">
        <comment>Add PROFILE_ITEM_TEXT_VALUE table.</comment>
        <createTable tableName="PROFILE_ITEM_TEXT_VALUE">
            <column autoIncrement="true" name="ID" type="BIGINT UNSIGNED">
                <constraints nullable="false" primaryKey="true"/>
            </column>
            <column defaultValue="" name="UID" type="CHAR(12)">
                <constraints nullable="false" unique="true"/>
            </column>
            <column defaultValueNumeric="0" name="STATUS" type="TINYINT UNSIGNED">
                <constraints nullable="false"/>
            </column>
            <column defaultValue="" name="VALUE" type="VARCHAR(255)">
                <constraints nullable="false"/>
            </column>
            <!-- Make liquibase create TIMESTAMP instead of DATETIME. -->
            <column name="CREATED" type="TIMESTAMP default '0000-00-00 00:00:00'">
                <constraints nullable="false"/>
            </column>
            <column name="MODIFIED" type="TIMESTAMP default '0000-00-00 00:00:00'">
                <constraints nullable="false"/>
            </column>
            <column name="PROFILE_ITEM_ID" type="BIGINT UNSIGNED">
                <constraints nullable="false"/>
            </column>
            <column name="ITEM_VALUE_DEFINITION_ID" type="INT UNSIGNED">
                <constraints nullable="false"/>
            </column>
        </createTable>
        <modifySql dbms="mysql">
             <append value=" ENGINE=InnoDB DEFAULT CHARSET=utf8"/>
        </modifySql>
        <modifySql>
            <replace replace="`UID` CHAR(12) DEFAULT '' NOT NULL"
                     with="UID CHAR(12) CHARACTER SET ascii COLLATE ascii_bin NOT NULL DEFAULT ''"/>
        </modifySql>
    </changeSet>

    <changeSet author="david" id="1-4">
        <comment>Add PROFILE_ITEM_NUMBER_VALUE table.</comment>
        <createTable tableName="PROFILE_ITEM_NUMBER_VALUE">
            <column autoIncrement="true" name="ID" type="BIGINT UNSIGNED">
                <constraints nullable="false" primaryKey="true"/>
            </column>
            <column defaultValue="" name="UID" type="CHAR(12)">
                <constraints nullable="false" unique="true"/>
            </column>
            <column defaultValueNumeric="0" name="STATUS" type="TINYINT UNSIGNED">
                <constraints nullable="false"/>
            </column>
            <column defaultValueNumeric="0.0" name="VALUE" type="DOUBLE">
                <constraints nullable="false"/>
            </column>
            <!-- Make liquibase create TIMESTAMP instead of DATETIME. -->
            <column name="CREATED" type="TIMESTAMP default '0000-00-00 00:00:00'">
                <constraints nullable="false"/>
            </column>
            <column name="MODIFIED" type="TIMESTAMP default '0000-00-00 00:00:00'">
                <constraints nullable="false"/>
            </column>
            <column name="PROFILE_ITEM_ID" type="BIGINT UNSIGNED">
                <constraints nullable="false"/>
            </column>
            <column name="ITEM_VALUE_DEFINITION_ID" type="INT UNSIGNED">
                <constraints nullable="false"/>
            </column>
            <column defaultValue="" name="UNIT" type="VARCHAR(255)">
                <constraints nullable="false"/>
            </column>
            <column defaultValue="" name="PER_UNIT" type="VARCHAR(255)">
                <constraints nullable="false"/>
            </column>
        </createTable>
        <modifySql dbms="mysql">
             <append value=" ENGINE=InnoDB DEFAULT CHARSET=utf8"/>
        </modifySql>
        <modifySql>
            <replace replace="`UID` CHAR(12) DEFAULT '' NOT NULL"
                     with="UID CHAR(12) CHARACTER SET ascii COLLATE ascii_bin NOT NULL DEFAULT ''"/>
        </modifySql>
    </changeSet>

    <changeSet author="david" id="1-5">
        <comment>Add DATA_ITEM_TEXT_VALUE table.</comment>
        <createTable tableName="DATA_ITEM_TEXT_VALUE">
            <column autoIncrement="true" name="ID" type="BIGINT UNSIGNED">
                <constraints nullable="false" primaryKey="true"/>
            </column>
            <column defaultValue="" name="UID" type="CHAR(12)">
                <constraints nullable="false" unique="true"/>
            </column>
            <column defaultValueNumeric="0" name="STATUS" type="TINYINT UNSIGNED">
                <constraints nullable="false"/>
            </column>
            <column defaultValue="" name="VALUE" type="VARCHAR(255)">
                <constraints nullable="false"/>
            </column>
            <!-- Make liquibase create TIMESTAMP instead of DATETIME. -->
            <column name="CREATED" type="TIMESTAMP default '0000-00-00 00:00:00'">
                <constraints nullable="false"/>
            </column>
            <column name="MODIFIED" type="TIMESTAMP default '0000-00-00 00:00:00'">
                <constraints nullable="false"/>
            </column>
            <column name="ITEM_VALUE_DEFINITION_ID" type="INT UNSIGNED">
                <constraints nullable="false"/>
            </column>
            <column name="DATA_ITEM_ID" type="BIGINT UNSIGNED">
                <constraints nullable="false"/>
            </column>
        </createTable>
        <modifySql dbms="mysql">
             <append value=" ENGINE=InnoDB DEFAULT CHARSET=utf8"/>
        </modifySql>
        <modifySql>
            <replace replace="`UID` CHAR(12) DEFAULT '' NOT NULL"
                     with="UID CHAR(12) CHARACTER SET ascii COLLATE ascii_bin NOT NULL DEFAULT ''"/>
        </modifySql>
    </changeSet>

    <changeSet author="david" id="1-6">
        <comment>Add DATA_ITEM_NUMBER_VALUE table.</comment>
        <createTable tableName="DATA_ITEM_NUMBER_VALUE">
            <column autoIncrement="true" name="ID" type="BIGINT UNSIGNED">
                <constraints nullable="false" primaryKey="true"/>
            </column>
            <column defaultValue="" name="UID" type="CHAR(12)">
                <constraints nullable="false" unique="true"/>
            </column>
            <column defaultValueNumeric="0" name="STATUS" type="TINYINT UNSIGNED">
                <constraints nullable="false"/>
            </column>
            <column defaultValueNumeric="0.0" name="VALUE" type="DOUBLE">
                <constraints nullable="false"/>
            </column>
            <!-- Make liquibase create TIMESTAMP instead of DATETIME. -->
            <column name="CREATED" type="TIMESTAMP default '0000-00-00 00:00:00'">
                <constraints nullable="false"/>
            </column>
            <column name="MODIFIED" type="TIMESTAMP default '0000-00-00 00:00:00'">
                <constraints nullable="false"/>
            </column>
            <column name="ITEM_VALUE_DEFINITION_ID" type="INT UNSIGNED">
                <constraints nullable="false"/>
            </column>
            <column name="DATA_ITEM_ID" type="BIGINT UNSIGNED">
                <constraints nullable="false"/>
            </column>
            <column defaultValue="" name="UNIT" type="VARCHAR(255)">
                <constraints nullable="false"/>
            </column>
            <column defaultValue="" name="PER_UNIT" type="VARCHAR(255)">
                <constraints nullable="false"/>
            </column>
        </createTable>
        <modifySql dbms="mysql">
             <append value=" ENGINE=InnoDB DEFAULT CHARSET=utf8"/>
        </modifySql>
        <modifySql>
            <replace replace="`UID` CHAR(12) DEFAULT '' NOT NULL"
                     with="UID CHAR(12) CHARACTER SET ascii COLLATE ascii_bin NOT NULL DEFAULT ''"/>
        </modifySql>
    </changeSet>

    <changeSet author="david" id="1-7">
        <comment>Add DATA_ITEM_TEXT_VALUE_HISTORY table.</comment>
        <createTable tableName="DATA_ITEM_TEXT_VALUE_HISTORY">
            <column autoIncrement="true" name="ID" type="BIGINT UNSIGNED">
                <constraints nullable="false" primaryKey="true"/>
            </column>
            <column defaultValue="" name="UID" type="CHAR(12)">
                <constraints nullable="false" unique="true"/>
            </column>
            <column defaultValueNumeric="0" name="STATUS" type="TINYINT UNSIGNED">
                <constraints nullable="false"/>
            </column>
            <column defaultValue="" name="VALUE" type="VARCHAR(255)">
                <constraints nullable="false"/>
            </column>
            <!-- Make liquibase create TIMESTAMP instead of DATETIME. -->
            <column name="CREATED" type="TIMESTAMP default '0000-00-00 00:00:00'">
                <constraints nullable="false"/>
            </column>
            <column name="MODIFIED" type="TIMESTAMP default '0000-00-00 00:00:00'">
                <constraints nullable="false"/>
            </column>
            <column name="ITEM_VALUE_DEFINITION_ID" type="INT UNSIGNED">
                <constraints nullable="false"/>
            </column>
            <column name="DATA_ITEM_ID" type="BIGINT UNSIGNED">
                <constraints nullable="false"/>
            </column>
            <column defaultValue="1000-01-01 00:00:00" name="START_DATE" type="DATETIME">
                <constraints nullable="false"/>
            </column>
        </createTable>
        <modifySql dbms="mysql">
             <append value=" ENGINE=InnoDB DEFAULT CHARSET=utf8"/>
        </modifySql>
        <modifySql>
            <replace replace="`UID` CHAR(12) DEFAULT '' NOT NULL"
                     with="UID CHAR(12) CHARACTER SET ascii COLLATE ascii_bin NOT NULL DEFAULT ''"/>
        </modifySql>
    </changeSet>

    <changeSet author="david" id="1-8">
        <comment>Add DATA_ITEM_NUMBER_VALUE_HISTORY table.</comment>
        <createTable tableName="DATA_ITEM_NUMBER_VALUE_HISTORY">
            <column autoIncrement="true" name="ID" type="BIGINT UNSIGNED">
                <constraints nullable="false" primaryKey="true"/>
            </column>
            <column defaultValue="" name="UID" type="CHAR(12)">
                <constraints nullable="false" unique="true"/>
            </column>
            <column defaultValueNumeric="0" name="STATUS" type="TINYINT UNSIGNED">
                <constraints nullable="false"/>
            </column>
            <column defaultValueNumeric="0.0" name="VALUE" type="DOUBLE">
                <constraints nullable="false"/>
            </column>
            <!-- Make liquibase create TIMESTAMP instead of DATETIME. -->
            <column name="CREATED" type="TIMESTAMP default '0000-00-00 00:00:00'">
                <constraints nullable="false"/>
            </column>
            <column name="MODIFIED" type="TIMESTAMP default '0000-00-00 00:00:00'">
                <constraints nullable="false"/>
            </column>
            <column name="ITEM_VALUE_DEFINITION_ID" type="INT UNSIGNED">
                <constraints nullable="false"/>
            </column>
            <column name="DATA_ITEM_ID" type="BIGINT UNSIGNED">
                <constraints nullable="false"/>
            </column>
            <column defaultValue="" name="UNIT" type="VARCHAR(255)">
                <constraints nullable="false"/>
            </column>
            <column defaultValue="" name="PER_UNIT" type="VARCHAR(255)">
                <constraints nullable="false"/>
            </column>
            <column defaultValue="1000-01-01 00:00:00" name="START_DATE" type="DATETIME">
                <constraints nullable="false"/>
            </column>
        </createTable>
        <modifySql dbms="mysql">
             <append value=" ENGINE=InnoDB DEFAULT CHARSET=utf8"/>
        </modifySql>
        <modifySql>
            <replace replace="`UID` CHAR(12) DEFAULT '' NOT NULL"
                     with="UID CHAR(12) CHARACTER SET ascii COLLATE ascii_bin NOT NULL DEFAULT ''"/>
        </modifySql>
    </changeSet>

    <!-- Altered tables -->
    <!-- Use sql tag so all changes for a table are executed in one statement. -->
    <changeSet author="david" id="1-9">
        <comment>Alter ALGORITHM</comment>
        <sql>
            ALTER TABLE ALGORITHM
            CHANGE ID ID INT(11) UNSIGNED NOT NULL AUTO_INCREMENT,
            CHANGE UID UID CHAR(12) CHARACTER SET ascii COLLATE ascii_bin NOT NULL DEFAULT '',
            CHANGE NAME NAME VARCHAR(255) NOT NULL DEFAULT '',
            CHANGE CREATED CREATED TIMESTAMP NOT NULL DEFAULT '0000-00-00 00:00:00',
            CHANGE MODIFIED MODIFIED TIMESTAMP NOT NULL DEFAULT '0000-00-00 00:00:00',
            CHANGE ALGORITHM_CONTEXT_ID ALGORITHM_CONTEXT_ID INT(11) UNSIGNED NULL DEFAULT NULL,
            CHANGE STATUS STATUS TINYINT(3) UNSIGNED NOT NULL DEFAULT '1'
        </sql>
    </changeSet>

    <changeSet author="david" id="1-10">
        <comment>Alter API_VERSION</comment>
        <sql>
            ALTER TABLE API_VERSION
            CHANGE ID ID TINYINT(3) UNSIGNED NOT NULL AUTO_INCREMENT,
            CHANGE CREATED CREATED TIMESTAMP NOT NULL DEFAULT '0000-00-00 00:00:00',
            CHANGE MODIFIED MODIFIED TIMESTAMP NOT NULL DEFAULT '0000-00-00 00:00:00',
            CHANGE UID UID CHAR(12) CHARACTER SET ascii COLLATE ascii_bin NOT NULL DEFAULT '',
            CHANGE VERSION VERSION VARCHAR(3) NOT NULL DEFAULT '',
            CHANGE STATUS STATUS TINYINT(3) UNSIGNED NOT NULL DEFAULT '1'
        </sql>
    </changeSet>

    <changeSet author="david" id="1-11">
        <comment>Alter DATA_CATEGORY</comment>
        <sql>
            ALTER TABLE DATA_CATEGORY
            CHANGE ID ID INT(11) UNSIGNED NOT NULL AUTO_INCREMENT,
            CHANGE UID UID CHAR(12) CHARACTER SET ascii COLLATE ascii_bin NOT NULL DEFAULT '',
            CHANGE NAME NAME VARCHAR(255) NOT NULL DEFAULT '',
            CHANGE PATH PATH VARCHAR(255) NOT NULL DEFAULT '',
            CHANGE CREATED CREATED TIMESTAMP NOT NULL DEFAULT '0000-00-00 00:00:00',
            CHANGE MODIFIED MODIFIED TIMESTAMP NOT NULL DEFAULT '0000-00-00 00:00:00',
            CHANGE DATA_CATEGORY_ID DATA_CATEGORY_ID INT(11) UNSIGNED NULL DEFAULT NULL,
            CHANGE ITEM_DEFINITION_ID ITEM_DEFINITION_ID INT(11) UNSIGNED NULL DEFAULT NULL,
            CHANGE STATUS STATUS TINYINT(3) UNSIGNED NOT NULL DEFAULT '1',
            CHANGE ALIASED_TO_ID ALIASED_TO_ID INT(11) UNSIGNED NULL DEFAULT NULL,
            CHANGE WIKI_NAME WIKI_NAME VARCHAR(255) NOT NULL DEFAULT ''
        </sql>
    </changeSet>

    <changeSet author="david" id="1-12">
        <comment>Alter ENTITY_TAG</comment>
        <sql>
            ALTER TABLE ENTITY_TAG
            CHANGE ID ID BIGINT(20) UNSIGNED NOT NULL AUTO_INCREMENT,
            CHANGE CREATED CREATED TIMESTAMP NOT NULL DEFAULT '0000-00-00 00:00:00',
            CHANGE MODIFIED MODIFIED TIMESTAMP NOT NULL DEFAULT '0000-00-00 00:00:00',
            CHANGE UID UID CHAR(12) CHARACTER SET ascii COLLATE ascii_bin NOT NULL DEFAULT '',
            CHANGE STATUS STATUS TINYINT(3) UNSIGNED NOT NULL DEFAULT '1',
            CHANGE ENTITY_ID ENTITY_ID BIGINT(20) UNSIGNED NOT NULL,
            CHANGE ENTITY_TYPE ENTITY_TYPE VARCHAR(3) NOT NULL DEFAULT '',
            CHANGE ENTITY_UID ENTITY_UID CHAR(12) CHARACTER SET ascii COLLATE ascii_bin NOT NULL DEFAULT '',
            CHANGE TAG_ID TAG_ID BIGINT(20) UNSIGNED NOT NULL
        </sql>
    </changeSet>

    <changeSet author="david" id="1-13">
        <comment>Alter GROUPS</comment>
        <sql>
            ALTER TABLE GROUPS CHANGE ID ID INT(11) UNSIGNED NOT NULL AUTO_INCREMENT,
            CHANGE UID UID CHAR(12) CHARACTER SET ascii COLLATE ascii_bin NOT NULL DEFAULT '',
            CHANGE NAME NAME VARCHAR(100) NOT NULL DEFAULT '',
            CHANGE CREATED CREATED TIMESTAMP NOT NULL DEFAULT '0000-00-00 00:00:00',
            CHANGE MODIFIED MODIFIED TIMESTAMP NOT NULL DEFAULT '0000-00-00 00:00:00',
            CHANGE STATUS STATUS TINYINT(3) UNSIGNED NOT NULL DEFAULT '1'
        </sql>
    </changeSet>

    <changeSet author="david" id="1-14">
        <comment>Alter GROUP_PRINCIPAL</comment>
        <sql>
            ALTER TABLE GROUP_PRINCIPAL
            CHANGE ID ID INT(11) UNSIGNED NOT NULL AUTO_INCREMENT,
            CHANGE UID UID CHAR(12) CHARACTER SET ascii COLLATE ascii_bin NOT NULL DEFAULT '',
            CHANGE STATUS STATUS TINYINT(3) UNSIGNED NOT NULL DEFAULT '1',
            CHANGE GROUP_ID GROUP_ID INT(11) UNSIGNED NOT NULL,
            CHANGE PRINCIPAL_ID PRINCIPAL_ID BIGINT(20) UNSIGNED NOT NULL,
            CHANGE PRINCIPAL_UID PRINCIPAL_UID CHAR(12) CHARACTER SET ascii COLLATE ascii_bin NOT NULL DEFAULT '',
            CHANGE PRINCIPAL_TYPE PRINCIPAL_TYPE VARCHAR(3) NOT NULL DEFAULT '',
            CHANGE CREATED CREATED TIMESTAMP NOT NULL DEFAULT '0000-00-00 00:00:00',
            CHANGE MODIFIED MODIFIED TIMESTAMP NOT NULL DEFAULT '0000-00-00 00:00:00'
        </sql>
    </changeSet>

    <changeSet author="david" id="1-15">
        <comment>Alter ITEM_DEFINITION. See: OPS-159.</comment>
        <sql>
            ALTER TABLE ITEM_DEFINITION
            CHANGE ID ID INT(11) UNSIGNED NOT NULL AUTO_INCREMENT ,
            CHANGE UID UID CHAR(12) CHARACTER SET ascii COLLATE ascii_bin NOT NULL DEFAULT '',
            CHANGE NAME NAME VARCHAR(255) NOT NULL DEFAULT '',
            CHANGE DRILL_DOWN DRILL_DOWN VARCHAR(255) NOT NULL DEFAULT '',
            CHANGE CREATED CREATED TIMESTAMP NOT NULL DEFAULT '0000-00-00 00:00:00',
            CHANGE MODIFIED MODIFIED TIMESTAMP NOT NULL DEFAULT '0000-00-00 00:00:00',
            CHANGE STATUS STATUS TINYINT(3) UNSIGNED NOT NULL DEFAULT '1',
            DROP COLUMN SKIP_RECALCULATION
        </sql>
    </changeSet>
    
    <changeSet author="david" id="1-16">
        <comment>Set NULL UNIT and PER_UNIT to ''</comment>
        <update tableName="ITEM_VALUE_DEFINITION">
            <column name="UNIT" value=""/>
            <where>UNIT IS NULL</where>
        </update>
        <update tableName="ITEM_VALUE_DEFINITION">
            <column name="PER_UNIT" value=""/>
            <where>PER_UNIT IS NULL</where>
        </update>
    </changeSet>

    <changeSet author="david" id="1-17">
        <comment>Alter ITEM_VALUE_DEFINITION</comment>
        <sql>
            ALTER TABLE ITEM_VALUE_DEFINITION
            CHANGE ID ID INT(11) UNSIGNED NOT NULL AUTO_INCREMENT,
            CHANGE UID UID CHAR(12) CHARACTER SET ascii COLLATE ascii_bin NOT NULL DEFAULT '',
            CHANGE NAME NAME VARCHAR(255) NOT NULL DEFAULT '',
            CHANGE PATH PATH VARCHAR(255) NOT NULL DEFAULT '',
            CHANGE VALUE VALUE VARCHAR(255) NOT NULL DEFAULT '',
            CHANGE CHOICES CHOICES VARCHAR(255) NOT NULL DEFAULT '',
            CHANGE FROM_PROFILE FROM_PROFILE BIT(1) NOT NULL DEFAULT b'0',
            CHANGE FROM_DATA FROM_DATA BIT(1) NOT NULL DEFAULT b'0',
            CHANGE ALLOWED_ROLES ALLOWED_ROLES VARCHAR(255) NOT NULL DEFAULT '',
            CHANGE CREATED CREATED TIMESTAMP NOT NULL DEFAULT '0000-00-00 00:00:00',
            CHANGE MODIFIED MODIFIED TIMESTAMP NOT NULL DEFAULT '0000-00-00 00:00:00',
            CHANGE ITEM_DEFINITION_ID ITEM_DEFINITION_ID INT(11) UNSIGNED NOT NULL,
            CHANGE VALUE_DEFINITION_ID VALUE_DEFINITION_ID INT(11) UNSIGNED NOT NULL,
            CHANGE UNIT UNIT VARCHAR(255) NOT NULL DEFAULT '',
            CHANGE PER_UNIT PER_UNIT VARCHAR(255) NOT NULL DEFAULT '',
            CHANGE ALIASED_TO_ID ALIASED_TO_ID INT(11) UNSIGNED NULL DEFAULT NULL,
            CHANGE STATUS STATUS TINYINT(3) UNSIGNED NOT NULL DEFAULT '0'
        </sql>
    </changeSet>

    <changeSet author="david" id="1-18">
        <comment>Alter ITEM_VALUE_DEFINITION_API_VERSION</comment>
        <sql>
            ALTER TABLE ITEM_VALUE_DEFINITION_API_VERSION
            CHANGE ITEM_VALUE_DEFINITION_ID ITEM_VALUE_DEFINITION_ID BIGINT(20) UNSIGNED NOT NULL,
            CHANGE API_VERSION_ID API_VERSION_ID BIGINT(20) UNSIGNED NOT NULL
        </sql>
    </changeSet>

    <changeSet author="david" id="1-19">
        <comment>Alter LOCALE_NAME</comment>
        <sql>
            ALTER TABLE LOCALE_NAME
            CHANGE ID ID BIGINT(20) UNSIGNED NOT NULL AUTO_INCREMENT,
            CHANGE CREATED CREATED TIMESTAMP NOT NULL DEFAULT '0000-00-00 00:00:00',
            CHANGE MODIFIED MODIFIED TIMESTAMP NOT NULL DEFAULT '0000-00-00 00:00:00',
            CHANGE UID UID CHAR(12) CHARACTER SET ascii COLLATE ascii_bin NOT NULL DEFAULT '',
            CHANGE STATUS STATUS TINYINT(3) UNSIGNED NOT NULL DEFAULT '1',
            CHANGE ENTITY_ID ENTITY_ID BIGINT(20) UNSIGNED NOT NULL,
            CHANGE ENTITY_TYPE ENTITY_TYPE VARCHAR(3) NOT NULL DEFAULT '',
            CHANGE ENTITY_UID ENTITY_UID CHAR(12) CHARACTER SET ascii COLLATE ascii_bin NOT NULL DEFAULT '',
            CHANGE LOCALE LOCALE VARCHAR(255) NOT NULL DEFAULT '',
            CHANGE NAME NAME VARCHAR(255) NOT NULL DEFAULT ''
        </sql>
    </changeSet>

    <changeSet author="david" id="1-20">
        <comment>Alter METADATA</comment>
        <sql>
            ALTER TABLE METADATA
            CHANGE ID ID BIGINT(20) UNSIGNED NOT NULL AUTO_INCREMENT,
            CHANGE CREATED CREATED TIMESTAMP NOT NULL DEFAULT '0000-00-00 00:00:00',
            CHANGE MODIFIED MODIFIED TIMESTAMP NOT NULL DEFAULT '0000-00-00 00:00:00',
            CHANGE UID UID CHAR(12) CHARACTER SET ascii COLLATE ascii_bin NOT NULL DEFAULT '',
            CHANGE STATUS STATUS TINYINT(3) UNSIGNED NOT NULL DEFAULT '1',
            CHANGE ENTITY_ID ENTITY_ID BIGINT(20) UNSIGNED NOT NULL ,
            CHANGE ENTITY_TYPE ENTITY_TYPE VARCHAR(3) NOT NULL DEFAULT '',
            CHANGE ENTITY_UID ENTITY_UID CHAR(12) CHARACTER SET ascii COLLATE ascii_bin NOT NULL DEFAULT '',
            CHANGE NAME NAME VARCHAR(255) NOT NULL DEFAULT ''
        </sql>
    </changeSet>

    <changeSet author="david" id="1-21">
        <comment>Alter PERMISSION</comment>
        <sql>
            ALTER TABLE PERMISSION
            CHANGE ID ID BIGINT(20) UNSIGNED NOT NULL AUTO_INCREMENT,
            CHANGE UID UID CHAR(12) CHARACTER SET ascii COLLATE ascii_bin NOT NULL DEFAULT '',
            CHANGE CREATED CREATED TIMESTAMP NOT NULL DEFAULT '0000-00-00 00:00:00',
            CHANGE MODIFIED MODIFIED TIMESTAMP NOT NULL DEFAULT '0000-00-00 00:00:00',
            CHANGE STATUS STATUS TINYINT(3) UNSIGNED NOT NULL DEFAULT '1',
            CHANGE ENTITY_ID ENTITY_ID BIGINT(20) UNSIGNED NOT NULL,
            CHANGE ENTITY_UID ENTITY_UID CHAR(12) CHARACTER SET ascii COLLATE ascii_bin NOT NULL DEFAULT '',
            CHANGE ENTITY_TYPE ENTITY_TYPE VARCHAR(3) NOT NULL DEFAULT '',
            CHANGE PRINCIPAL_ID PRINCIPAL_ID BIGINT(20) UNSIGNED NOT NULL ,
            CHANGE PRINCIPAL_UID PRINCIPAL_UID CHAR(12) CHARACTER SET ascii COLLATE ascii_bin NOT NULL DEFAULT '',
            CHANGE PRINCIPAL_TYPE PRINCIPAL_TYPE VARCHAR(3) NOT NULL DEFAULT '',
            CHANGE ENTRIES ENTRIES VARCHAR(1000) NOT NULL DEFAULT ''
        </sql>
    </changeSet>

    <changeSet author="david" id="1-22">
        <comment>Alter PROFILE</comment>
        <sql>
            ALTER TABLE PROFILE
            CHANGE ID ID BIGINT(20) UNSIGNED NOT NULL AUTO_INCREMENT,
            CHANGE UID UID CHAR(12) CHARACTER SET ascii COLLATE ascii_bin NOT NULL DEFAULT '',
            CHANGE PATH PATH VARCHAR(255) NOT NULL DEFAULT '',
            CHANGE NAME NAME VARCHAR(255) NOT NULL DEFAULT '',
            CHANGE CREATED CREATED TIMESTAMP NOT NULL DEFAULT '0000-00-00 00:00:00',
            CHANGE MODIFIED MODIFIED TIMESTAMP NOT NULL DEFAULT '0000-00-00 00:00:00',
            CHANGE STATUS STATUS TINYINT(3) UNSIGNED NOT NULL DEFAULT '1',
            CHANGE USER_ID USER_ID BIGINT(20) UNSIGNED NOT NULL,
            ADD INDEX USER_ID_KEY (USER_ID)
        </sql>
    </changeSet>
    
    <changeSet author="david" id="1-23">
        <comment>Alter RETURN_VALUE_DEFINITION</comment>
        <sql>
            ALTER TABLE RETURN_VALUE_DEFINITION
            CHANGE ID ID BIGINT(20) UNSIGNED NOT NULL AUTO_INCREMENT,
            CHANGE UID UID CHAR(12) CHARACTER SET ascii COLLATE ascii_bin NOT NULL DEFAULT '',
            CHANGE CREATED CREATED TIMESTAMP NOT NULL DEFAULT '0000-00-00 00:00:00',
            CHANGE MODIFIED MODIFIED TIMESTAMP NOT NULL DEFAULT '0000-00-00 00:00:00',
            CHANGE ITEM_DEFINITION_ID ITEM_DEFINITION_ID INT(11) UNSIGNED NOT NULL,
            CHANGE VALUE_DEFINITION_ID VALUE_DEFINITION_ID INT(11) UNSIGNED NOT NULL,
            CHANGE TYPE TYPE VARCHAR(255) NOT NULL DEFAULT '',
            CHANGE UNIT UNIT VARCHAR(255) NOT NULL DEFAULT '',
            CHANGE PER_UNIT PER_UNIT VARCHAR(255) NOT NULL DEFAULT '',
            CHANGE STATUS STATUS TINYINT(3) UNSIGNED NOT NULL DEFAULT '1',
            CHANGE DEFAULT_TYPE DEFAULT_TYPE BIT(1) NOT NULL DEFAULT b'0'
        </sql>
    </changeSet>
    
    <changeSet author="david" id="1-24">
        <comment>Alter TAG</comment>
        <sql>
            ALTER TABLE TAG
            CHANGE ID ID INT(11) UNSIGNED NOT NULL AUTO_INCREMENT,
            CHANGE CREATED CREATED TIMESTAMP NOT NULL DEFAULT '0000-00-00 00:00:00',
            CHANGE MODIFIED MODIFIED TIMESTAMP NOT NULL DEFAULT '0000-00-00 00:00:00',
            CHANGE UID UID CHAR(12) CHARACTER SET ascii COLLATE ascii_bin NOT NULL,
            CHANGE STATUS STATUS TINYINT(3) UNSIGNED NOT NULL DEFAULT '1',
            CHANGE TAG TAG VARCHAR(255) NOT NULL DEFAULT ''
        </sql>
    </changeSet>

    <changeSet author="david" id="1-25">
        <comment>Set NULL LOCALE to ''</comment>
        <update tableName="USER">
            <column name="LOCALE" value=""/>
            <where>LOCALE IS NULL</where>
        </update>
    </changeSet>

    <changeSet author="david" id="1-26">
        <comment>Alter USER</comment>
        <sql>
            ALTER TABLE USER
            CHANGE ID ID BIGINT(20) UNSIGNED NOT NULL AUTO_INCREMENT,
            CHANGE UID UID CHAR(12) CHARACTER SET ascii COLLATE ascii_bin NOT NULL DEFAULT '',
            CHANGE STATUS STATUS TINYINT(3) UNSIGNED NOT NULL DEFAULT '1',
            CHANGE USERNAME USERNAME VARCHAR(20) NOT NULL,
            CHANGE PASSWORD PASSWORD VARCHAR(40) NOT NULL,
            CHANGE CREATED CREATED TIMESTAMP NOT NULL DEFAULT '0000-00-00 00:00:00',
            CHANGE MODIFIED MODIFIED TIMESTAMP NOT NULL DEFAULT '0000-00-00 00:00:00',
            CHANGE USER_TYPE USER_TYPE INT(11) NOT NULL,
            CHANGE API_VERSION_ID API_VERSION_ID TINYINT(3) UNSIGNED NOT NULL,
            CHANGE LOCALE LOCALE VARCHAR(12) NOT NULL DEFAULT '',
            CHANGE TIME_ZONE TIME_ZONE VARCHAR(255) NOT NULL DEFAULT 'UTC',
            DROP INDEX USERNAME_IND,
            ADD UNIQUE INDEX USERNAME_KEY (USERNAME)
        </sql>
    </changeSet>

    <changeSet author="david" id="1-27">
        <comment>Alter VALUE_DEFINITION.</comment>
        <sql>
            ALTER TABLE VALUE_DEFINITION
            CHANGE ID ID INT(11) UNSIGNED NOT NULL AUTO_INCREMENT,
            CHANGE UID UID CHAR(12) CHARACTER SET ascii COLLATE ascii_bin NOT NULL DEFAULT '',
            CHANGE NAME NAME VARCHAR(255) NOT NULL DEFAULT '',
            CHANGE DESCRIPTION DESCRIPTION VARCHAR(255) NOT NULL DEFAULT '',
            CHANGE VALUE_TYPE VALUE_TYPE TINYINT(3) NOT NULL DEFAULT '0',
            CHANGE CREATED CREATED TIMESTAMP NOT NULL DEFAULT '0000-00-00 00:00:00',
            CHANGE MODIFIED MODIFIED TIMESTAMP NOT NULL DEFAULT '0000-00-00 00:00:00',
            CHANGE STATUS STATUS TINYINT(3) UNSIGNED NOT NULL DEFAULT '1'
        </sql>
    </changeSet>

    <!-- Indexes -->
    <!-- Must use custom sql to work around this MySQL bug: http://bugs.mysql.com/bug.php?id=48875 -->
    <changeSet author="david" id="1-28">
        <comment>Add indexes to DATA_ITEM</comment>
        <sql>
            ALTER TABLE DATA_ITEM
            ADD INDEX PATH_KEY (PATH),
            ADD INDEX ITEM_DEFINITION_ID_KEY (ITEM_DEFINITION_ID),
            ADD INDEX DATA_CATEGORY_ID_KEY (DATA_CATEGORY_ID)
        </sql>
    </changeSet>

    <changeSet author="david" id="1-29">
        <comment>Add indexes to PROFILE_ITEM</comment>
        <sql>
            ALTER TABLE PROFILE_ITEM
            ADD INDEX ITEM_DEFINITION_ID_KEY (ITEM_DEFINITION_ID),
            ADD INDEX DATA_ITEM_ID_KEY (DATA_ITEM_ID),
            ADD INDEX PROFILE_ID_KEY (PROFILE_ID)
        </sql>
    </changeSet>

    <changeSet author="david" id="1-30">
        <comment>Add indexes to PROFILE_ITEM_TEXT_VALUE</comment>
        <sql>
            ALTER TABLE PROFILE_ITEM_TEXT_VALUE
            ADD INDEX ITEM_VALUE_DEFINITION_ID_KEY (ITEM_VALUE_DEFINITION_ID),
            ADD INDEX PROFILE_ITEM_ID_KEY (PROFILE_ITEM_ID)
        </sql>
    </changeSet>

    <changeSet author="david" id="1-31">
        <comment>Add indexes to PROFILE_ITEM_NUMBER_VALUE</comment>
        <sql>
            ALTER TABLE PROFILE_ITEM_NUMBER_VALUE
            ADD INDEX ITEM_VALUE_DEFINITION_ID_KEY (ITEM_VALUE_DEFINITION_ID),
            ADD INDEX PROFILE_ITEM_ID_KEY (PROFILE_ITEM_ID)
        </sql>
    </changeSet>

    <changeSet author="david" id="1-32">
        <comment>Add indexes to DATA_ITEM_TEXT_VALUE</comment>
        <sql>
            ALTER TABLE DATA_ITEM_TEXT_VALUE
            ADD INDEX ITEM_VALUE_DEFINITION_ID_KEY (ITEM_VALUE_DEFINITION_ID),
            ADD INDEX DATA_ITEM_ID_KEY (DATA_ITEM_ID)
        </sql>
    </changeSet>

    <changeSet author="david" id="1-33">
        <comment>Add indexes to DATA_ITEM_NUMBER_VALUE</comment>
        <sql>
            ALTER TABLE DATA_ITEM_NUMBER_VALUE
            ADD INDEX ITEM_VALUE_DEFINITION_ID_KEY (ITEM_VALUE_DEFINITION_ID),
            ADD INDEX DATA_ITEM_ID_KEY (DATA_ITEM_ID)
        </sql>
    </changeSet>

    <changeSet author="david" id="1-34">
        <comment>Add indexes to DATA_ITEM_TEXT_VALUE_HISTORY</comment>
        <sql>
            ALTER TABLE DATA_ITEM_TEXT_VALUE_HISTORY
            ADD INDEX ITEM_VALUE_DEFINITION_ID_KEY (ITEM_VALUE_DEFINITION_ID),
            ADD INDEX DATA_ITEM_ID_KEY (DATA_ITEM_ID)
        </sql>
    </changeSet>

    <changeSet author="david" id="1-35">
        <comment>Add indexes to DATA_ITEM_NUMBER_VALUE_HISTORY</comment>
        <sql>
            ALTER TABLE DATA_ITEM_NUMBER_VALUE_HISTORY
            ADD INDEX ITEM_VALUE_DEFINITION_ID_KEY (ITEM_VALUE_DEFINITION_ID),
            ADD INDEX DATA_ITEM_ID_KEY (DATA_ITEM_ID)
        </sql>
    </changeSet>

    <!-- Drop old permission table -->
    <changeSet author="david" id="1-36">
        <comment>Drop PERMISSION_BACKUP</comment>
        <dropTable tableName="PERMISSION_BACKUP"/>
    </changeSet>

</databaseChangeLog>
